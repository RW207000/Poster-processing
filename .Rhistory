write.csv(OHP2023_2024stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/OHP2023_2024stats.csv", row.names = F)
write.csv(OHP2022_2023stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/OHP2022_2023stats.csv", row.names = F)
Andoframe <- select(labs_wide, c("Centre.ID", "assessment_id", "assessment_date", "andostenedione.value", "andostenedione.interpretation"))
Andoframe <- filter(Andoframe, !andostenedione.interpretation == "NULL")
Andoframe$numericvalue <-as.numeric(str_extract(Andoframe$andostenedione.value, "[0-9]+.?[0-9]*+"))
Andoframe$unit <- (str_extract(Andoframe$andostenedione.value, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+"))
Andoframe_2023_2024 <- Andoframe %>%
filter(assessment_date > "2023-12-01") %>%
group_by(Centre.ID, andostenedione.interpretation) %>%
summarise(n = n()) %>%
pivot_wider(names_from = andostenedione.interpretation,
values_from = n)
Ando2023_2024_no_entries <- anti_join(centreIDs2022_2024, Andoframe_2023_2024, by = "Centre.ID")
Andoframe_2023_2024 <- full_join(Ando2023_2024_no_entries, Andoframe_2023_2024, by = "Centre.ID")
Andoframe_2023_2024 <- Andoframe_2023_2024 [order(Andoframe_2023_2024$Centre.ID),]
Andoframe_2022_2023 <- Andoframe %>%
filter(assessment_date < "2023-12-01" & assessment_date > "2022-12-01") %>%
group_by(Centre.ID, andostenedione.interpretation) %>%
summarise(n = n()) %>%
pivot_wider(names_from = andostenedione.interpretation,
values_from = n) %>%
select(1,3,2,4)
Ando2022_2023_no_entries <- anti_join(centreIDs2022_2024, Andoframe_2022_2023, by = "Centre.ID")
Andoframe_2022_2023 <- full_join(Ando2022_2023_no_entries, Andoframe_2022_2023, by = "Centre.ID")
Andoframe_2022_2023 <- Andoframe_2022_2023 [order(Andoframe_2022_2023$Centre.ID),]
write.csv(Andoframe_2022_2023, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Andoframe_2022_2023.csv", row.names = F)
write.csv(Andoframe_2023_2024, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Andoframe_2023_2024.csv", row.names = F)
#check units, standardise if necessary
table(Andoframe$unit)
Ando2023_2024stats <- Andoframe %>%
filter(assessment_date > "2023-12-01") %>%
group_by(Centre.ID) %>%
summarise(visits_with_ando_data = n_unique(assessment_id),
mean_value = mean(numericvalue, na.rm = TRUE),
median_value = median(numericvalue, na.rm = TRUE),
sd_value = sd(numericvalue, na.rm = TRUE),
min_value = min(numericvalue, na.rm = TRUE),
max_value = max(numericvalue, na.rm = TRUE)) %>%
round(., digits = 2)
Ando2023_2024stats <- full_join(Ando2023_2024_no_entries, Ando2023_2024stats, by = "Centre.ID")
Ando2023_2024stats <- Ando2023_2024stats [order(Ando2023_2024stats$Centre.ID),]
Ando2022_2023stats <- Andoframe %>%
filter(assessment_date < "2023-12-01" & assessment_date > "2022-12-01") %>%
group_by(Centre.ID) %>%
summarise(visits_with_OHP_data = n_unique(assessment_id),
mean_value = mean(numericvalue, na.rm = TRUE),
median_value = median(numericvalue, na.rm = TRUE),
sd_value = sd(numericvalue, na.rm = TRUE),
min_value = min(numericvalue, na.rm = TRUE),
max_value = max(numericvalue, na.rm = TRUE)) %>%
round(., digits = 2)
Ando2022_2023stats <- full_join(Ando2022_2023_no_entries, Ando2022_2023stats, by = "Centre.ID")
Ando2022_2023stats <- Ando2022_2023stats [order(Ando2022_2023stats$Centre.ID),]
write.csv(Ando2023_2024stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Ando2023_2024stats.csv", row.names = F)
write.csv(Ando2022_2023stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Ando2022_2023stats.csv", row.names = F)
Reninframe <- select(labs_wide, c("Centre.ID", "assessment_id", "assessment_date", "renin.value", "renin.interpretation"))
Reninframe <- filter(Reninframe, !renin.interpretation == "NULL")
Reninframe$numericvalue <-as.numeric(str_extract(Reninframe$renin.value, "[0-9]+.?[0-9]*+"))
Reninframe$unit <- (str_extract(Reninframe$renin.value, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+"))
Reninframe$reninplasmaactivity <- (Reninframe$numericvalue * 0.158)
Reninframe$reninplasmaactivity <- round(Reninframe$reninplasmaactivity, digits = 2)
Reninframe_2023_2024 <- Reninframe %>%
filter(assessment_date > "2023-12-01") %>%
group_by(Centre.ID, renin.interpretation) %>%
summarise(n = n()) %>%
pivot_wider(names_from = renin.interpretation,
values_from = n)
Renin2023_2024_no_entries <- anti_join(centreIDs2022_2024, Reninframe_2023_2024, by = "Centre.ID")
Reninframe_2023_2024 <- full_join(Renin2023_2024_no_entries, Reninframe_2023_2024, by = "Centre.ID")
Reninframe_2023_2024 <- Reninframe_2023_2024 [order(Reninframe_2023_2024$Centre.ID),]
Reninframe_2022_2023 <- Reninframe %>%
filter(assessment_date < "2023-12-01" & assessment_date > "2022-12-01") %>%
group_by(Centre.ID, renin.interpretation) %>%
summarise(n = n()) %>%
pivot_wider(names_from = renin.interpretation,
values_from = n)
Renin2022_2023_no_entries <- anti_join(centreIDs2022_2024, Reninframe_2022_2023, by = "Centre.ID")
Reninframe_2022_2023 <- full_join(Renin2022_2023_no_entries, Reninframe_2022_2023, by = "Centre.ID")
Reninframe_2022_2023 <- Reninframe_2022_2023 [order(Reninframe_2022_2023$Centre.ID),]
write.csv(Reninframe_2022_2023, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Reninframe_2022_2023.csv", row.names = F)
write.csv(Reninframe_2023_2024, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Oct2024/My versions/Cleaned/Cleaned processing/outputs/Reninframe_2023_2024.csv", row.names = F)
#check units, standardise if necessary
table(Reninframe$unit)
#NEED CLARIFICATION ON UNITS AND SUBSEQUENT STANDARDISATION.
# proportionsummary <- participantsnoduplicates %>%
#   group_by(coid_assedate) %>%
#   summarise_each(funs(sum(!is.na(.))/length(.)))
#
# variableproportions <- proportionsummary %>% summarise_each(mean)
#
# variableproportionst <- t(variableproportions)
# variableproportionst <- as.data.frame(variableproportionst)
# variableproportionst <- rownames_to_column(variableproportionst, var="Var1")
#
# names(variableproportionst)[names(variableproportionst)=="V1"] <- "averageproportiondata"
#
# variablesinfo <- full_join(structure, variableproportionst, by = "Var1")
# names(variablesinfo)[names(variablesinfo)=="Length"] <- "n_visits"
pcntMissing <- function(col) length(col[col == ""])/length(col)
# for participant data
participant_data_2023_2024 <- participantsnoduplicates %>%
filter(Date...CAH.Longitudinal.Data > "2023-12-01")
missing_participant_data_2023_2024 <- participant_data_2023_2024 %>%
group_by(Centre.ID) %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
participant_data_2022_2023 <- participantsnoduplicates %>%
filter(Date...CAH.Longitudinal.Data < "2023-12-01" & Date...CAH.Longitudinal.Data > "2022-12-01")
missing_participant_data_2022_2023 <- participant_data_2022_2023 %>%
group_by(Centre.ID) %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
# for lab data
pcntMissinglabs <- function(col) length(col[col == "NULL" | ""])/length(col)
lab_data_2023_2024 <- labs_wide %>%
filter(assessment_date > "2023-12-01")
# missing_lab_data_2023_2024 <- lab_data_2023_2024 %>%
#   group_by(Centre.ID) %>%
#   summarise(across(everything(), pcntMissinglabs)) %>%
#   round(., digits = 2)
# for med data
pcntMissingmeds <- function(col) length(col[col == "NULL" | ""])/length(col)
print("Script complete")
View(labentries2022_2023)
here()
all_participants <- read.csv("data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
all_participants <- read.csv("data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
here::here()
all_participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
s/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
View(participants)
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(all_medication, c("cols"), cutoff = 1)
medication <- remove_empty(medication, c("cols"), cutoff = 1)
medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# freqcheck
View(duplicateassessments)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# freqcheck
toremove <- duplicateassessments$idvisitdate
removedrecords <- subset(participants, coid_assedate %in% toremove)
write.csv(removedrecords, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/removed_records", row.names = F)
duplicateassessments$id <- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 1)
duplicateassessments$visitdate<- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 2)
toremovelostparticipants <- participantsnoduplicates$CO.ID
lostparticipants <- NA
lostparticipants <- subset(participants, !CO.ID %in% toremovelostparticipants)
write.csv(lostparticipants, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/lostparticipants.csv", row.names = F)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# valuesdrop <- c("result", "date_and_time")
# labsvalues <- labs[, !names(labs) %in% valuesdrop]
# labsvalues <- labsvalues %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "value")
#
# interpdrop <- c("value", "date_and_time")
# labsinterp <- labs[, !names(labs) %in% interpdrop]
# labsinterp <- labsinterp %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "result")
#
# labswide <- left_join(labsvalues, labsinterp, by = c("CO.ID", "assessment_id", "assessment_date", "Centre.ID"))
#
# names(labswide) <- gsub(x = names(labswide), pattern = ".x",
#                         replacement = ".value")
# names(labswide) <- gsub(x = names(labswide), pattern = ".y",
#                         replacement = ".interpretation")
#
# labsorder <- c("Centre.ID", "CO.ID", "date_of_birth.value", "assessment_id", "assessment_date", "total_testosterone.value", "total_testosterone.interpretation", "sodium.value", "sodium.interpretation", "potassium.value", "potassium.interpretation", "acth.value", "acth.interpretation", "cortisol.value", "cortisol.interpretation", "glucose.value", "glucose.interpretation", "renin.value", "renin.interpretation", "ohp17.value", "ohp17.interpretation", "andostenedione.value", "andostenedione.interpretation", "shbg.value", "shbg.interpretation", "haemoglobin.value", "haemoglobin.interpretation", "haematocrit.value", "haematocrit.interpretation", "lh.value", "lh.interpretation", "fsh.value", "fsh.interpretation", "dheas.value", "dheas.interpretation","oestradiol.value", "oestradiol.interpretation", "progesterone.value", "progesterone.interpretation", "plasma_renin_activi.interpretation.value", "plasma_renin_activi.interpretation.interpretation", "urine_steroids_.interpretation_gcms.value", "urine_steroids_.interpretation_gcms.interpretation", "di.interpretationdrotestosterone.value", "di.interpretationdrotestosterone.interpretation")
# labswide <- labswide[, labsorder]
#
# labswide[labswide == "NULL"] <- NA
Today <- Sys.Date()
visitdateparticipants <- participantsnoduplicates$Date...CAH.Longitudinal.Data
visitdateparticipants <- as.Date(visitdateparticipants,
format = "%d/%m/%Y")
participantsnoduplicates$Date...CAH.Longitudinal.Data <- as.Date(participantsnoduplicates$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
sexcolumns <- c("Centre.ID", "CO.ID", "Sex.at.birth...Birth", "Date...CAH.Longitudinal.Data", "coid_assedate", "timesincelastvisit")
sexdataframe <- participantsnoduplicates[, sexcolumns]
participantsnoduplicates$Date...CAH.Longitudinal.Data <- as.Date(participantsnoduplicates$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# freqcheck
toremove <- duplicateassessments$idvisitdate
removedrecords <- subset(participants, coid_assedate %in% toremove)
write.csv(removedrecords, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/removed_records", row.names = F)
duplicateassessments$id <- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 1)
duplicateassessments$visitdate<- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 2)
toremovelostparticipants <- participantsnoduplicates$CO.ID
lostparticipants <- NA
lostparticipants <- subset(participants, !CO.ID %in% toremovelostparticipants)
write.csv(lostparticipants, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/lostparticipants.csv", row.names = F)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# valuesdrop <- c("result", "date_and_time")
# labsvalues <- labs[, !names(labs) %in% valuesdrop]
# labsvalues <- labsvalues %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "value")
#
# interpdrop <- c("value", "date_and_time")
# labsinterp <- labs[, !names(labs) %in% interpdrop]
# labsinterp <- labsinterp %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "result")
#
# labswide <- left_join(labsvalues, labsinterp, by = c("CO.ID", "assessment_id", "assessment_date", "Centre.ID"))
#
# names(labswide) <- gsub(x = names(labswide), pattern = ".x",
#                         replacement = ".value")
# names(labswide) <- gsub(x = names(labswide), pattern = ".y",
#                         replacement = ".interpretation")
#
# labsorder <- c("Centre.ID", "CO.ID", "date_of_birth.value", "assessment_id", "assessment_date", "total_testosterone.value", "total_testosterone.interpretation", "sodium.value", "sodium.interpretation", "potassium.value", "potassium.interpretation", "acth.value", "acth.interpretation", "cortisol.value", "cortisol.interpretation", "glucose.value", "glucose.interpretation", "renin.value", "renin.interpretation", "ohp17.value", "ohp17.interpretation", "andostenedione.value", "andostenedione.interpretation", "shbg.value", "shbg.interpretation", "haemoglobin.value", "haemoglobin.interpretation", "haematocrit.value", "haematocrit.interpretation", "lh.value", "lh.interpretation", "fsh.value", "fsh.interpretation", "dheas.value", "dheas.interpretation","oestradiol.value", "oestradiol.interpretation", "progesterone.value", "progesterone.interpretation", "plasma_renin_activi.interpretation.value", "plasma_renin_activi.interpretation.interpretation", "urine_steroids_.interpretation_gcms.value", "urine_steroids_.interpretation_gcms.interpretation", "di.interpretationdrotestosterone.value", "di.interpretationdrotestosterone.interpretation")
# labswide <- labswide[, labsorder]
#
# labswide[labswide == "NULL"] <- NA
sexcolumns <- c("Centre.ID", "CO.ID", "Sex.at.birth...Birth", "Date...CAH.Longitudinal.Data", "coid_assedate", "timesincelastvisit")
sexdataframe <- participantsnoduplicates[, sexcolumns]
overallsex <- as.data.frame(table(participantsnoduplicates$Sex.at.birth...Birth))
propoverallsex <- as.data.frame(prop.table(table(participantsnoduplicates$Sex.at.birth...Birth)))
View(propoverallsex)
overallsex <- left_join(overallsex, propoverallsex,
by = "Var1")
overallsex <- overallsex %>%
rename("Sex at birth" = "Var1",
"Frequency" = "Freq.x",
"Proportion" = "Freq.y")
sexcolumns <- c("Centre.ID", "CO.ID", "Sex.at.birth...Birth", "Date...CAH.Longitudinal.Data", "coid_assedate", "timesincelastvisit")
sexdataframe <- participantsnoduplicates[, sexcolumns]
names(participantsnoduplicatesp)
names(participantsnoduplicates)
visitsperparticipant <- participantsnoduplicates %>%
group_by(CO.ID) %>%
summarise(n=n())
overallvisitsstats <- visitsperparticipant %>%
summarise("total number of patients" = n(),
meanvisits = mean(n, na.rm = TRUE),
medianvisits = median(n, na.rm = TRUE),                                            sdvisits = sd(n, na.rm = TRUE),
minvisits = min(n, na.rm = TRUE),
maxvisits = max(n, na.rm = TRUE)) %>%
round(digits = 2)
overallvisitsstats$total_visits <- sum(visitsperparticipant$n)
View(overallvisitsstats)
View(visitsperparticipant)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# freqcheck
toremove <- duplicateassessments$idvisitdate
removedrecords <- subset(participants, coid_assedate %in% toremove)
write.csv(removedrecords, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/removed_records", row.names = F)
duplicateassessments$id <- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 1)
duplicateassessments$visitdate<- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 2)
toremovelostparticipants <- participantsnoduplicates$CO.ID
lostparticipants <- NA
lostparticipants <- subset(participants, !CO.ID %in% toremovelostparticipants)
write.csv(lostparticipants, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/lostparticipants.csv", row.names = F)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# valuesdrop <- c("result", "date_and_time")
# labsvalues <- labs[, !names(labs) %in% valuesdrop]
# labsvalues <- labsvalues %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "value")
#
# interpdrop <- c("value", "date_and_time")
# labsinterp <- labs[, !names(labs) %in% interpdrop]
# labsinterp <- labsinterp %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "result")
#
# labswide <- left_join(labsvalues, labsinterp, by = c("CO.ID", "assessment_id", "assessment_date", "Centre.ID"))
#
# names(labswide) <- gsub(x = names(labswide), pattern = ".x",
#                         replacement = ".value")
# names(labswide) <- gsub(x = names(labswide), pattern = ".y",
#                         replacement = ".interpretation")
#
# labsorder <- c("Centre.ID", "CO.ID", "date_of_birth.value", "assessment_id", "assessment_date", "total_testosterone.value", "total_testosterone.interpretation", "sodium.value", "sodium.interpretation", "potassium.value", "potassium.interpretation", "acth.value", "acth.interpretation", "cortisol.value", "cortisol.interpretation", "glucose.value", "glucose.interpretation", "renin.value", "renin.interpretation", "ohp17.value", "ohp17.interpretation", "andostenedione.value", "andostenedione.interpretation", "shbg.value", "shbg.interpretation", "haemoglobin.value", "haemoglobin.interpretation", "haematocrit.value", "haematocrit.interpretation", "lh.value", "lh.interpretation", "fsh.value", "fsh.interpretation", "dheas.value", "dheas.interpretation","oestradiol.value", "oestradiol.interpretation", "progesterone.value", "progesterone.interpretation", "plasma_renin_activi.interpretation.value", "plasma_renin_activi.interpretation.interpretation", "urine_steroids_.interpretation_gcms.value", "urine_steroids_.interpretation_gcms.interpretation", "di.interpretationdrotestosterone.value", "di.interpretationdrotestosterone.interpretation")
# labswide <- labswide[, labsorder]
#
# labswide[labswide == "NULL"] <- NA
Today <- Sys.Date()
visitdateparticipants <- participantsnoduplicates$Date...CAH.Longitudinal.Data
visitdateparticipants <- as.Date(visitdateparticipants,
format = "%d/%m/%Y")
participantsnoduplicates$Date...CAH.Longitudinal.Data <- as.Date(participantsnoduplicates$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
Today <- Sys.Date()
visitdateparticipants <- participantsnoduplicates$Date...CAH.Longitudinal.Data
visitdateparticipants <- as.Date(visitdateparticipants,
format = "%d/%m/%Y")
# participantsnoduplicates$Date...CAH.Longitudinal.Data <- as.Date(participantsnoduplicates$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
# participantsnoduplicates$timesincelastvisit <- Today - visitdateparticipants
sexcolumns <- c("Centre.ID", "CO.ID", "Sex.at.birth...Birth", "Date...CAH.Longitudinal.Data", "coid_assedate", "timesincelastvisit")
sexdataframe <- participantsnoduplicates[, sexcolumns]
visitsperparticipant <- participantsnoduplicates %>%
group_by(CO.ID) %>%
summarise(n=n())
overallvisitsstats <- visitsperparticipant %>%
summarise("total number of patients" = n(),
meanvisits = mean(n, na.rm = TRUE),
medianvisits = median(n, na.rm = TRUE),
sdvisits = sd(n, na.rm = TRUE),
minvisits = min(n, na.rm = TRUE),
maxvisits = max(n, na.rm = TRUE)) %>%
round(digits = 2)
overallvisitsstats$total_visits <- sum(visitsperparticipant$n)
glimpse(participants)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
n_unique(participants$CO.ID)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
participants$coid_assedate <- paste(participants$CO.ID, participants$Date...CAH.Longitudinal.Data, sep = " ")
duplicates <- freq(participants$coid_assedate)
duplicatesframe <- as.data.frame(duplicates)
duplicatesframe <- rownames_to_column(duplicatesframe, var="idvisitdate")
duplicatesframe <- duplicatesframe[duplicatesframe$idvisitdate != c("Total", "<NA>"),]
duplicatesframe <- duplicatesframe[-c(3:6)]
duplicateassessments <- duplicatesframe %>%
filter(Freq>1)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# freqcheck
toremove <- duplicateassessments$idvisitdate
removedrecords <- subset(participants, coid_assedate %in% toremove)
write.csv(removedrecords, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/removed_records", row.names = F)
duplicateassessments$id <- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 1)
duplicateassessments$visitdate<- sapply(strsplit(duplicateassessments$idvisitdate," "), `[`, 2)
toremovelostparticipants <- participantsnoduplicates$CO.ID
lostparticipants <- NA
lostparticipants <- subset(participants, !CO.ID %in% toremovelostparticipants)
write.csv(lostparticipants, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/lostparticipants.csv", row.names = F)
idvisitstoremove <- duplicateassessments$idvisitdate
participantsnoduplicates <- subset(participants, !coid_assedate %in% idvisitstoremove)
freqcheck <- as.data.frame(freq(participantsnoduplicates$coid_assedate))
freqcheck <- rownames_to_column(freqcheck, var="idvisitdate")
freqcheck <- freqcheck[freqcheck$idvisitdate != c("Total", "<NA>"),]
# valuesdrop <- c("result", "date_and_time")
# labsvalues <- labs[, !names(labs) %in% valuesdrop]
# labsvalues <- labsvalues %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "value")
#
# interpdrop <- c("value", "date_and_time")
# labsinterp <- labs[, !names(labs) %in% interpdrop]
# labsinterp <- labsinterp %>%
#   pivot_wider(names_from = "labs_type",
#               values_from = "result")
#
# labswide <- left_join(labsvalues, labsinterp, by = c("CO.ID", "assessment_id", "assessment_date", "Centre.ID"))
#
# names(labswide) <- gsub(x = names(labswide), pattern = ".x",
#                         replacement = ".value")
# names(labswide) <- gsub(x = names(labswide), pattern = ".y",
#                         replacement = ".interpretation")
#
# labsorder <- c("Centre.ID", "CO.ID", "date_of_birth.value", "assessment_id", "assessment_date", "total_testosterone.value", "total_testosterone.interpretation", "sodium.value", "sodium.interpretation", "potassium.value", "potassium.interpretation", "acth.value", "acth.interpretation", "cortisol.value", "cortisol.interpretation", "glucose.value", "glucose.interpretation", "renin.value", "renin.interpretation", "ohp17.value", "ohp17.interpretation", "andostenedione.value", "andostenedione.interpretation", "shbg.value", "shbg.interpretation", "haemoglobin.value", "haemoglobin.interpretation", "haematocrit.value", "haematocrit.interpretation", "lh.value", "lh.interpretation", "fsh.value", "fsh.interpretation", "dheas.value", "dheas.interpretation","oestradiol.value", "oestradiol.interpretation", "progesterone.value", "progesterone.interpretation", "plasma_renin_activi.interpretation.value", "plasma_renin_activi.interpretation.interpretation", "urine_steroids_.interpretation_gcms.value", "urine_steroids_.interpretation_gcms.interpretation", "di.interpretationdrotestosterone.value", "di.interpretationdrotestosterone.interpretation")
# labswide <- labswide[, labsorder]
#
# labswide[labswide == "NULL"] <- NA
Today <- Sys.Date()
visitdateparticipants <- participantsnoduplicates$Date...CAH.Longitudinal.Data
visitdateparticipants <- as.Date(visitdateparticipants,
format = "%d/%m/%Y")
# participantsnoduplicates$Date...CAH.Longitudinal.Data <- as.Date(participantsnoduplicates$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
# participantsnoduplicates$timesincelastvisit <- Today - visitdateparticipants
sexcolumns <- c("Centre.ID", "CO.ID", "Sex.at.birth...Birth", "Date...CAH.Longitudinal.Data", "coid_assedate", "timesincelastvisit")
sexdataframe <- participantsnoduplicates[, sexcolumns]
visitsperparticipant <- participantsnoduplicates %>%
group_by(CO.ID) %>%
summarise(n=n())
View(visitsperparticipant)
