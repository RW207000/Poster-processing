medication_clean$Standardised.doses <- NA
medication_clean$Standardised.doses <- as.character(medication_clean$Standardised.doses)
medication_clean$Standardised.doses <-
ifelse(medication_clean$Medicine == "Hydrocortisone", medication_clean$Dose, NA)
medication_clean$Standardised.doses <-
ifelse(medication_clean$Medicine == "Prednisolone", (as.numeric(medication_clean$Dose) * prednisoloneratio), medication_clean$Standardised.doses)
medication_clean$Standardised.doses <-
ifelse(medication_clean$Medicine == "Dexamethasone", (as.numeric(medication_clean$Dose) * dexamethasoneratio), medication_clean$Standardised.doses)
# medication_clean$Standardised.doses <-
#   ifelse(medication_clean$Medicine == "Other", medication_clean$Dose, NA)
# Let's do it first using individual doses
checkmedstats <- medication_clean %>%
group_by(Medicine) %>%
summarise(mean_dose = mean(Standardised.doses, na.rm = TRUE),
median_dose = median(Standardised.doses, na.rm = TRUE),
sd_dose = sd(Standardised.doses, na.rm = TRUE),
min_dose = min(Standardised.doses, na.rm = TRUE),
max_dose = max(Standardised.doses, na.rm = TRUE)) %>%
mutate_if(is.numeric, ~round(., 2))
# Now let's do it for total_daily_doses
medperpatient <- medication_clean %>%
group_by(assessment_id) %>%
summarise(total_standardised_daily_dose_1 = sum(Standardised.doses, na.rm = TRUE))
medication_clean <- full_join(medication_clean, medperpatient, by = "assessment_id")
checkdailymedstats <- medication_clean %>%
group_by(Medicine) %>%
summarise(mean_standardised_dose = mean(total_standardised_daily_dose_1, na.rm = TRUE),
median_standardised_dose = median(total_standardised_daily_dose_1, na.rm = TRUE),
sd_standardised_dose = sd(total_standardised_daily_dose_1, na.rm = TRUE),
min_standardised_dose = min(total_standardised_daily_dose_1, na.rm = TRUE),
max_standardised_dose = max(total_standardised_daily_dose_1, na.rm = TRUE)) %>%
mutate_if(is.numeric, ~round(., 2))
medication_clean$Time <-
ifelse(medication_clean$Time!=0,
as.numeric(medication_clean$Time),
NA)
medication_clean$dose_time_hours <- as.numeric(medication_clean$Time / 3600)
# times show up as 8.0 (for 8am), 21.0 (for 9pm) etc. This is useful for subsequent analysis using time :)
medication_clean$assessment_entry <-
ave(medication_clean$CO.ID,
medication_clean$assessment_id,
FUN = seq_along)
totalmed_1st_entry <-
medication_clean %>%
filter(assessment_entry==1)
totalmed_2nd_entry <-
medication_clean %>%
filter(assessment_entry==2)
totalmed_3rd_entry <-
medication_clean %>%
filter(assessment_entry==3)
totalmed_4th_entry <-
medication_clean %>%
filter(assessment_entry==4)
totalmed_5th_entry <-
medication_clean %>%
filter(assessment_entry==5)
totalmed_6th_entry <-
medication_clean %>%
filter(assessment_entry==6)
#now we can get rid of the assessment entry column
# medication$assessment_entry <- NULL
totalmed_1st_entry$assessment_entry <- NULL
totalmed_2nd_entry$assessment_entry <- NULL
totalmed_3rd_entry$assessment_entry <- NULL
totalmed_4th_entry$assessment_entry <- NULL
totalmed_5th_entry$assessment_entry <- NULL
totalmed_6th_entry$assessment_entry <- NULL
#then add the appropriate suffix based on the assessment_entry number to each column in these frames to make them different before joining
colnames(totalmed_1st_entry) <-
paste(colnames(totalmed_1st_entry), 1, sep="_")
colnames(totalmed_2nd_entry) <-
paste(colnames(totalmed_2nd_entry), 2, sep="_")
colnames(totalmed_3rd_entry) <-
paste(colnames(totalmed_3rd_entry), 3, sep="_")
colnames(totalmed_4th_entry) <-
paste(colnames(totalmed_4th_entry), 4, sep="_")
colnames(totalmed_5th_entry) <-
paste(colnames(totalmed_5th_entry), 5, sep="_")
colnames(totalmed_6th_entry) <-
paste(colnames(totalmed_6th_entry), 6, sep="_")
totalmed_1st_entry <- totalmed_1st_entry %>%
rename("CO.ID" = "CO.ID_1",
"assessment_id" = "assessment_id_1")
totalmed_2nd_entry <- totalmed_2nd_entry %>%
rename("CO.ID" = "CO.ID_2",
"assessment_id" = "assessment_id_2")
totalmed_3rd_entry <- totalmed_3rd_entry %>%
rename("CO.ID" = "CO.ID_3",
"assessment_id" = "assessment_id_3")
totalmed_4th_entry <- totalmed_4th_entry %>%
rename("CO.ID" = "CO.ID_4",
"assessment_id" = "assessment_id_4")
totalmed_5th_entry <- totalmed_5th_entry %>%
rename("CO.ID" = "CO.ID_5",
"assessment_id" = "assessment_id_5")
totalmed_6th_entry <- totalmed_6th_entry %>%
rename("CO.ID" = "CO.ID_6",
"assessment_id" = "assessment_id_6")
meds_wide <- totalmed_1st_entry %>%
left_join(totalmed_2nd_entry, by=c("CO.ID", "assessment_id")) %>%
left_join(totalmed_3rd_entry, by=c("CO.ID", "assessment_id")) %>%
left_join(totalmed_4th_entry, by=c("CO.ID", "assessment_id")) %>%
left_join(totalmed_5th_entry, by=c("CO.ID", "assessment_id")) %>%
left_join(totalmed_6th_entry, by=c("CO.ID", "assessment_id"))
#add in 'total daily dose' from 'medperpatient' to meds_wide
totaldailyformedswide <- select(medperpatient, c("assessment_id", "total_standardised_daily_dose_1"))
meds_wide <- meds_wide %>%
left_join(select(medperpatient, assessment_id, total_standardised_daily_dose_1), by = "assessment_id")
meds_wide <- meds_wide %>%
select_if(function(x) !all(is.na(x)))
write.csv(meds_wide, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/meds_wide.csv", row.names = F)
medperpatient$number_of_doses <- medication_clean %>%
group_by(assessment_id) %>%
summarise(max(assessment_entry))
patient_medicine <- select(meds_wide, c("assessment_id", "Medicine_1"))
patient_w_h <- select(longitudinal, c("Assessment.ID", "Weight..kg.", "Height..cm."))
absolute_med_values <- select(meds_wide, )
medperpatient <- left_join(medperpatient, patient_medicine, by = "assessment_id")
medperpatient <- left_join(medperpatient, patient_w_h, join_by("assessment_id" == "Assessment.ID"))
write.csv(medperpatient, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/medperpatient.csv", row.names = F)
medicationentries <- medication_clean %>%
group_by(assessment_id) %>%
summarise(n = n())
overallvisitsstats$visitswithmed <- n_unique(meds_wide$assessment_id)
overallvisitsstats$patientswithmed <- n_unique(meds_wide$CO.ID)
write.csv(overallvisitsstats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/overallvisitsstats.csv", row.names = F)
medication_clean$prescribedmedperpatient <- paste(medication_clean$coid_asse_id, medication_clean$Medicine)
medprescriptions <- subset(medication_clean, assessment_entry == 1)
all_prescriptions <- medprescriptions %>%
group_by(Medicine) %>%
summarise(n = n()) %>%
pivot_wider(names_from = Medicine,
values_from = n) %>%
select(1,2,5,4,3)
prescriptions_last_12m <- medprescriptions %>%
group_by(Medicine) %>%
filter(Date.of.Assessment >= "2024-02-07") %>%
summarise(n = n()) %>%
pivot_wider(names_from = Medicine,
values_from = n)
prescriptions_1_to_5_yrs <- medprescriptions %>%
group_by(Medicine) %>%
filter(Date.of.Assessment < "2024-02-07") %>%
summarise(n = n()) %>%
pivot_wider(names_from = Medicine,
values_from = n)
write.csv(all_prescriptions, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_prescriptions.csv", row.names = F)
write.csv(prescriptions_last_12m, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/prescriptions_last_12m.csv", row.names = F)
write.csv(prescriptions_1_to_5_yrs, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/prescriptions_1_to_5_yrs.csv", row.names = F)
othermeds <- subset(medication_clean, Medicine == "Other")
# make a new data frame with just medicine type
medtherapy <- select(meds_wide, c("CO.ID", "assessment_id", "Date.of.Assessment_1", "Medicine_1", "Medicine_2", "Medicine_3", "Medicine_4"))
medtherapy_last12m_frame <- medtherapy %>%
filter(Date.of.Assessment_1 >= "2024-02-07")
medtherapy_1_to_5_years_frame <- medtherapy %>%
filter(Date.of.Assessment_1 < "2024-02-07")
# need to work out how to make a legit output for seeing how many patients are on multiple medications simultaneously, but for now, this code works.
blah <- apply(medtherapy, 1, function(x) length (unique(x)))
blah <- as.data.frame(blah)
medtherapy_last12m <- apply(medtherapy_last12m_frame, 1, function(x) length (unique(x)))
medtherapy_last12m <- as.data.frame(medtherapy_last12m)
medtherapy_1_to_5_years <- apply(medtherapy_1_to_5_years_frame, 1, function(x) length (unique(x)))
medtherapy_1_to_5_years <- as.data.frame(medtherapy_1_to_5_years)
# write csvs
write.csv(medtherapy_last12m_frame, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/medtherapy_last12m_frame.csv", row.names = F)
write.csv(medtherapy_1_to_5_years_frame, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/medtherapy_1_to_5_years_frame.csv", row.names = F)
# https://stackoverflow.com/questions/74737100/how-to-check-if-multiple-columns-are-row-wise-equivalent-ignoring-na-values
med_simplified <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/medication_simplified.csv", header=T, na.strings= c("", "NA"))
med_simplified$Date <- meds_wide$Date.of.Assessment_1
med_simplified_last_12m <- med_simplified %>%
filter(Date >= "2024-02-07")
med_simplified_1_to_5_year <- med_simplified %>%
filter(Date < "2024-02-07")
write.csv(med_simplified, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/med_simplified.csv", row.names = F)
write.csv(med_simplified_last_12m, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/med_simplified_last_12m.csv", row.names = F)
write.csv(med_simplified_1_to_5_year, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/med_simplified_1_to_5_year.csv", row.names = F)
valuesdrop <- c("Result", "assessments.content.labs.date_and_time_lab", "Time")
labsvalues <- labs[, !names(labs) %in% valuesdrop]
labsvalues <- labsvalues %>%
pivot_wider(names_from = "Type",
values_from = "Value")
interpdrop <- c("Value", "assessments.content.labs.date_and_time_lab", "Time")
labsinterp <- labs[, !names(labs) %in% interpdrop]
labsinterp <- labsinterp %>%
pivot_wider(names_from = "Type",
values_from = "Result")
labs_wide <- left_join(labsvalues, labsinterp, by = c("CO.ID", "Assessment.ID", "Date"))
names(labs_wide) <- gsub(x = names(labs_wide), pattern = ".x",
replacement = ".value")
names(labs_wide) <- gsub(x = names(labs_wide), pattern = ".y",
replacement = ".interpretation")
# labsorder <- c("CO.ID", "Assessment.ID", "Date", "Total_testosterone.value", "Total_testosterone.interpretation", "Sodium.value", "Sodium.interpretation", "Potassium.value", "Potassium.interpretation", "acth.value", "acth.interpretation", "cortisol.value", "cortisol.interpretation", "glucose.value", "glucose.interpretation", "renin.value", "renin.interpretation", "ohp17.value", "ohp17.interpretation", "andostenedione.value", "andostenedione.interpretation", "shbg.value", "shbg.interpretation", "haemoglobin.value", "haemoglobin.interpretation", "haematocrit.value", "haematocrit.interpretation", "lh.value", "lh.interpretation", "fsh.value", "fsh.interpretation", "dheas.value", "dheas.interpretation","oestradiol.value", "oestradiol.interpretation", "progesterone.value", "progesterone.interpretation", "plasma_renin_activi.interpretation.value", "plasma_renin_activi.interpretation.interpretation", "urine_steroids_.interpretation_gcms.value", "urine_steroids_.interpretation_gcms.interpretation", "di.interpretationdrotestosterone.value", "di.interpretationdrotestosterone.interpretation")
# labs_wide <- labs_wide[, labsorder]
CAH_biomarkers <- select(labs_wide, c("Assessment.ID", "CO.ID", "Date", "17-OHP.value", "17-OHP.interpretation", "Androstenedione.value", "Androstenedione.interpretation", "Renin.value", "Renin.interpretation", "Total testosterone.value", "Total testosterone.interpretation", "Glucose.value", "Glucose.interpretation"))
# 17-OHP
CAH_biomarkers$`17-OHP.unit` <- str_extract(CAH_biomarkers$`17-OHP.value`, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+")
CAH_biomarkers$`17-OHP.value` <- as.numeric(str_extract(CAH_biomarkers$`17-OHP.value`, "[0-9]+.?[0-9]*+"))
# androstenedione
CAH_biomarkers$`Androstenedione.unit` <- str_extract(CAH_biomarkers$`Androstenedione.value`, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+")
CAH_biomarkers$`Androstenedione.value` <- as.numeric(str_extract(CAH_biomarkers$`Androstenedione.value`, "[0-9]+.?[0-9]*+"))
# testosterone
CAH_biomarkers$`Total.testosterone.unit` <- str_extract(CAH_biomarkers$`Total testosterone.value`, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+")
CAH_biomarkers$`Total testosterone.value` <- as.numeric(str_extract(CAH_biomarkers$`Total testosterone.value`, "[0-9]+.?[0-9]*+"))
# renin
CAH_biomarkers$`Renin.unit` <- str_extract(CAH_biomarkers$`Renin.value`, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+")
CAH_biomarkers$`Renin.value` <- as.numeric(str_extract(CAH_biomarkers$`Renin.value`, "[0-9]+.?[0-9]*+"))
CAH_biomarkers$Renin.plasma.activity <- (CAH_biomarkers$Renin.value * 0.158)
CAH_biomarkers$Renin.plasma.activity <- round(CAH_biomarkers$Renin.plasma.activity, digits = 2)
# glucose
CAH_biomarkers$Glucose.unit <- str_extract(CAH_biomarkers$Glucose.value, "[aA-zZ]+.?[aA-zZ]+.?[aA-zZ]*+")
CAH_biomarkers$Glucose.value <- as.numeric(str_extract(CAH_biomarkers$Glucose.value, "[0-9]+.?[0-9]*+"))
CAH_biomarkers_order <- c("Assessment.ID", "CO.ID", "Date", "17-OHP.value", "17-OHP.unit", "17-OHP.interpretation", "Androstenedione.value", "Androstenedione.unit", "Androstenedione.interpretation", "Renin.value", "Renin.unit", "Renin.interpretation", "Renin.plasma.activity", "Total testosterone.value", "Total.testosterone.unit", "Total testosterone.interpretation", "Glucose.value", "Glucose.interpretation")
CAH_biomarkers <- CAH_biomarkers[, CAH_biomarkers_order]
write.csv(CAH_biomarkers, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers.csv", row.names = F)
# Now time frames
CAH_biomarkers$Date <- as.Date(CAH_biomarkers$Date, format = "%d/%m/%Y")
CAH_biomarkers_last12m <- CAH_biomarkers %>%
filter(Date >= "2024-02-07")
CAH_biomarkers_1_to_5_yrs <- CAH_biomarkers %>%
filter(Date < "2024-02-07")
write.csv(CAH_biomarkers_last12m, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers_last12m.csv", row.names = F)
write.csv(CAH_biomarkers_1_to_5_yrs, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers_1_to_5_yrs.csv", row.names = F)
glucose <- select(CAH_biomarkers, c("Glucose.value"))
glucose_last_12m <- select(CAH_biomarkers_last12m, c("Glucose.value"))
glucose_1_to_5_yrs <- select(CAH_biomarkers_1_to_5_yrs, c("Glucose.value"))
write.csv(glucose_last_12m, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/glucose_last_12m.csv", row.names = F)
write.csv(glucose_1_to_5_yrs, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/glucose_1_to_5_yrs.csv", row.names = F)
overallvisitsstats$number_of_labs_entries <- length(labs_wide$CO.ID)
overallvisitsstats$number_of_lab_patients <- n_unique(labs_wide$CO.ID)
write.csv(overallvisitsstats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/overallvisitsstats.csv", row.names = F)
BMIframe <- select(longitudinal, c("Assessment.ID", "Date.of.Assessment", "BMI"))
BMIframe$Class <- ""
BMIframe$Class [BMIframe$BMI <18.5] <- "Underweight"
BMIframe$Class [BMIframe$BMI >= 18.5 & BMIframe$BMI <25] <- "Normal"
BMIframe$Class [BMIframe$BMI >= 25 & BMIframe$BMI <30] <- "Overweight"
BMIframe$Class [BMIframe$BMI >=30 & BMIframe$BMI <35] <- "Obese"
BMIframe$Class [BMIframe$BMI >=35] <- "Extremely obese"
BMIframe$Class[BMIframe$Class == ""] <- "Missing"
BMIstats <- BMIframe %>%
group_by(Class) %>%
summarise(n = n()) %>%
pivot_wider(names_from = "Class",
values_from = "n") %>%
select(1,4,5,6,3,2)
# time frames
BMIframe_last_12m <- BMIframe %>%
filter(Date.of.Assessment >= "2024-02-07")
BMIstats_last_12m <- BMIframe_last_12m %>%
group_by(Class) %>%
summarise(n = n()) %>%
pivot_wider(names_from = "Class",
values_from = "n") %>%
select(1,4,5,6,3,2)
BMIframe_1_to_5_yrs <- BMIframe %>%
filter(Date.of.Assessment < "2024-02-07")
BMIstats_1_to_5_yrs <- BMIframe_1_to_5_yrs %>%
group_by(Class) %>%
summarise(n = n()) %>%
pivot_wider(names_from = "Class",
values_from = "n") %>%
select(1,4,5,6,3,2)
write.csv(BMIstats_last_12m, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/BMIstats_last_12m.csv", row.names = F, na = "")
write.csv(BMIstats_1_to_5_yrs, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/BMIstats_1_to_5_yrs.csv", row.names = F, na = "")
# just need to extract blood pressure columns
blood_pressures <- select(longitudinal, c("Assessment.ID", "CO.ID", "Date.of.Assessment", "Systolic.Blood.Pressure", "Diastolic.Blood.Pressure"))
blood_pressures$Class <- ""
# normal
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure <= 120 & blood_pressures$Diastolic.Blood.Pressure < 80] <- "Normal"
# elevated
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure >= 120 & blood_pressures$Systolic.Blood.Pressure < 129 & blood_pressures$Diastolic.Blood.Pressure <80] <- "Elevated"
# Hypertension Stage 1
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure >= 130 & blood_pressures$Systolic.Blood.Pressure < 139 | blood_pressures$Diastolic.Blood.Pressure >= 80 & blood_pressures$Diastolic.Blood.Pressure < 89] <- "Hypertension Stage 1"
# Hypertension Stage 2
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure >= 140 & blood_pressures$Systolic.Blood.Pressure < 180 | blood_pressures$Diastolic.Blood.Pressure >= 90 & blood_pressures$Diastolic.Blood.Pressure < 120] <- "Hypertension Stage 2"
# Hypertension Stage 2 (or)
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure >= 180 |  blood_pressures$Diastolic.Blood.Pressure >= 90] <- "Hypertension Stage 2"
# Hypertension Stage 2 (and)
blood_pressures$Class [blood_pressures$Systolic.Blood.Pressure >= 180 &  blood_pressures$Diastolic.Blood.Pressure >= 90] <- "Hypertension Stage 2"
write.csv(blood_pressures, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/blood_pressures.csv", row.names = F)
OHPframe <- select(labs_wide, c("Centre.ID", "assessment_id", "assessment_date", "ohp17.value", "ohp17.interpretation"))
View(patients_per_centre)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
longitudinal <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Longitudinal data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants_longitudinal <- merge(participants, longitudinal, by = "CO.ID",
all = TRUE)
participants_longitudinal$Date.of.Assessment <- as.Date(participants_longitudinal$Date.of.Assessment, format = "%d/%m/%Y")
#make unique identifier
participants_longitudinal$CO.ID_assessment_date <- paste0(participants_longitudinal$CO.ID, participants_longitudinal$Date.of.Assessment)
write.csv(participants_longitudinal, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/participants_longitudinal.csv", row.names = F)
centres <-as.data.frame(unique(participants_longitudinal$Centre.ID.x))
centres <- centres %>%
rename("Centre ID" = "unique(participants_longitudinal$Centre.ID.x)")
print("There are")
length(centres$`Centre ID`)
print("centres")
patients_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID)) %>%
as.data.frame() %>%
rename("number of patients" = "n_unique(CO.ID)")
visits_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n = n()) %>%
rename("number of visits" = "n")
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-11-30"  & Date.of.Assessment > "2023-11-30") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
#
visits_per_patient_per_centre_Nov23_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2023-11-30"  & Date.of.Assessment > "2022-11-30") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov23_Nov22.csv", row.names = F)
write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
#
visits_per_patient_per_centre_before_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment >= "2022-11-30") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_before_Nov22.csv", row.names = F)
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
centre_stats <- full_join(patients_per_centre, visits_per_centre, by = "Centre.ID.x")
write.csv(centre_stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/centre_stats.csv", row.names = F)
meds_wide <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/meds_wide.csv", header=T, na.strings= c("", "NA"))
# format date
meds_wide$Date.of.Assessment_1 <- as.Date(meds_wide$Date.of.Assessment_1, format = "%Y-%m-%d")
# let's add unique identifier
meds_wide$CO.ID_assessment_date <- paste0(meds_wide$CO.ID, meds_wide$Date.of.Assessment_1)
# identify and remove any duplicates
med_duplicates <- as.data.frame(freq(meds_wide$CO.ID_assessment_date))
med_duplicates <- rownames_to_column(med_duplicates, var="CO.ID_assessment_date")
med_duplicates <- med_duplicates[med_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
med_duplicates <- med_duplicates[-c(3:6)]
med_duplicates <- med_duplicates %>%
filter(Freq>1)
med_to_remove <- med_duplicates$CO.ID_assessment_date
meds_wide_no_duplicates <- subset(meds_wide, !CO.ID_assessment_date %in% med_to_remove)
# all frequencies here should be 1
med_freq_check <- as.data.frame(freq(meds_wide_no_duplicates$CO.ID_assessment_date))
# instances of 'other' in medicine names need to be rectified. I have done this manually in excel for now.
adjusted_medication_names <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/adjusted_medication_names.csv", header=T, na.strings= c("", "NA"))
adjusted_medication_names$Date <- as.Date(adjusted_medication_names$Date, format = "%d/%m/%Y")
adjusted_medication_names$CO.ID_assessment_date <- paste0(adjusted_medication_names$CO.ID, adjusted_medication_names$Date)
# now need to link to meds_wide_no_duplicates
meds_wide_adj <- left_join(meds_wide_no_duplicates, adjusted_medication_names, by = c("CO.ID_assessment_date"))
# now let's tidy up the columns
# replace other with actual medication
meds_wide_adj$Medicine_1.x <- meds_wide_adj$Medicine_1.y
meds_wide_adj$Medicine_2.x <- meds_wide_adj$Medicine_2.y
meds_wide_adj$Medicine_3.x <- meds_wide_adj$Medicine_3.y
meds_wide_adj$Medicine_4.x <- meds_wide_adj$Medicine_4.y
biomarkers <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers.csv", header=T, na.strings= c("", "NA"))
# format date
biomarkers$Date <- as.Date(biomarkers$Date, format = "%d/%m/%Y")
# add unique identifier
biomarkers$CO.ID_assessment_date <- paste0(biomarkers$CO.ID, biomarkers$Date)
# identify and remove any duplicates
biomarker_duplicates <- as.data.frame(freq(biomarkers$CO.ID_assessment_date))
biomarker_duplicates <- rownames_to_column(biomarker_duplicates, var="CO.ID_assessment_date")
biomarker_duplicates <- biomarker_duplicates[biomarker_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
biomarker_duplicates <- biomarker_duplicates[-c(3:6)]
biomarker_duplicates <- biomarker_duplicates %>%
filter(Freq>1)
biomarkers_to_remove <- biomarker_duplicates$CO.ID_assessment_date
biomarkers_no_duplicates <- subset(biomarkers, !CO.ID_assessment_date %in% biomarkers_to_remove)
# all frequencies here should be 1
biomarker_freq_check <- as.data.frame(freq(biomarkers_no_duplicates$CO.ID_assessment_date))
all_data <- left_join(participants_longitudinal, meds_wide_adj, by = c("CO.ID_assessment_date"))
all_data <- left_join(all_data, biomarkers_no_duplicates, by = c("CO.ID_assessment_date"))
write.csv(all_data, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data.csv", row.names = FALSE, na = "")
all_data_Feb25_Nov24 <- all_data %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30")
write.csv(all_data_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Feb25_Nov24.csv", row.names = FALSE, na = "")
all_data_Nov24_Nov23 <- all_data %>%
filter(Date.of.Assessment <= "2024-11-30"  & Date.of.Assessment > "2023-11-30")
write.csv(all_data_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov24_Nov23.csv", row.names = FALSE, na = "")
all_data_Nov23_Nov22 <- all_data %>%
filter(Date.of.Assessment <= "2023-11-30"  & Date.of.Assessment > "2022-11-30")
write.csv(all_data_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov23_Nov22.csv", row.names = FALSE, na = "")
all_data_before_Nov22 <- all_data %>%
filter(Date.of.Assessment >= "2022-11-30")
write.csv(all_data_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_before_Nov22.csv", row.names = FALSE, na = "")
pcntMissing <- function(col) length(col[col == ""])/length(col)
missing_data_per_centre <- all_data %>%
group_by(Centre.ID.x) %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre.csv", row.names = FALSE, na = "")
missing_data_per_centre_Feb25_Nov24 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Feb25_Nov24.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov24_Nov23 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2024-11-30"  & Date.of.Assessment > "2023-11-30") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov24_Nov23.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov23_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2023-11-30"  & Date.of.Assessment > "2022-11-30") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov23_Nov22.csv", row.names = FALSE, na = "")
missing_data_per_centre_before_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment > "2022-11-30") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_before_Nov22.csv", row.names = FALSE, na = "")
participants_per_centre_Feb25_Nov24 <- all_data_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
participants_per_centre_Nov24_Nov23 <- all_data_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
participants_per_centre_Nov23_Nov22 <- all_data_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
minimal_dataset_columns <- c("Centre.ID.x", "CO.ID.x", "Date.of.Birth.x", "Sex.at.birth.x", "Associated.conditions.x", "Age", "Weight..kg.", "Height..cm.", "BMI", "BSA", "Systolic.Blood.Pressure", "Diastolic.Blood.Pressure", "Diabetes.mellitus.type.1", "Diabetes.mellitus.type.1.note", "Diabetes.Mellitus.Type.2", "Diabetes.Mellitus.Type.2.note", "Hypertension", "Hypertension.note", "Thyroid.Disease", "Thyroid.Disease.note", "Osteoporosis", "Osteoporosis.note", "Stroke", "Stroke.note", "Cardiovascular.Disease", "Cardiovascular.Disease.note", "Smoking", "Smoking.note", "Anaemia", "Anaemia.note", "Depression", "Depression.note", "Anxiety", "Anxiety.note", "Psychosis", "Psychosis.note", "Other.Mental.Health.Problems", "Other.Mental.Health.Problems.note", "Joint.Hypermobility", "Joint.Hypermobility.note", "Other", "Other.note","Testicular.volume.left..ml.", "Testicular.volume.right..ml.", "Testicular.texture", "Evidence.of.TART", "Fertility.desired", "Fertility.attempted", "Sperm.storage", "Number.of.offspring", "History.of.assisted.conception", "Breast.stage", "Menarche", "Age.at.first.menstruation", "Regular.menstrual.cycle", "Number.of.pregnancies.in.the.past", "Number.of.live.births", "Notes",
"Medicine_1.x", "Dose_1", "Unit_1", "Standardised.doses_1", "dose_time_hours_1",
"Medicine_2.x", "Dose_2", "Unit_2", "Standardised.doses_2", "dose_time_hours_2",
"Medicine_3.x", "Dose_3", "Unit_3", "Standardised.doses_3", "dose_time_hours_3",
"Medicine_4.x", "Dose_4", "Unit_4", "Standardised.doses_4",
"total_standardised_daily_dose_1_1",
"Medicine_1.y", "Medicine_2.y", "Medicine_3.y", "Medicine_4.y",
"Assessment.ID.y", "Date.y", "X17.OHP.value", "X17.OHP.unit", "X17.OHP.interpretation", "Androstenedione.value", "Androstenedione.unit", "Androstenedione.interpretation", "Renin.value", "Renin.unit", "Renin.interpretation", "Renin.plasma.activity", "Total.testosterone.value", "Total.testosterone.unit", "Total.testosterone.interpretation", "Glucose.value", "Glucose.interpretation")
minimal_dataset <- all_data[, minimal_dataset_columns]
write.csv(minimal_dataset, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/minimal_data_set.csv", row.names = FALSE, na = "")
print("Script complete")
View(participants_per_centre_Feb25_Nov24)
View(visits_stats_Feb25_Nov24)
View(all_data_Nov24_Nov23)
View(missing_data_per_centre_Nov24_Nov23)
View(participants_per_centre_Nov24_Nov23)
View(visits_per_patient_per_centre_Nov24_Nov23)
minimal_dataset_Feb25_Nov24 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30")
View(minimal_dataset)
View(all_data)
names(all_data)
minimal_dataset_columns <- c("Centre.ID.x", "CO.ID.x", "Date.of.Assessment", "Date.of.Birth.x", "Sex.at.birth.x", "Associated.conditions.x", "Age", "Weight..kg.", "Height..cm.", "BMI", "BSA", "Systolic.Blood.Pressure", "Diastolic.Blood.Pressure", "Diabetes.mellitus.type.1", "Diabetes.mellitus.type.1.note", "Diabetes.Mellitus.Type.2", "Diabetes.Mellitus.Type.2.note", "Hypertension", "Hypertension.note", "Thyroid.Disease", "Thyroid.Disease.note", "Osteoporosis", "Osteoporosis.note", "Stroke", "Stroke.note", "Cardiovascular.Disease", "Cardiovascular.Disease.note", "Smoking", "Smoking.note", "Anaemia", "Anaemia.note", "Depression", "Depression.note", "Anxiety", "Anxiety.note", "Psychosis", "Psychosis.note", "Other.Mental.Health.Problems", "Other.Mental.Health.Problems.note", "Joint.Hypermobility", "Joint.Hypermobility.note", "Other", "Other.note","Testicular.volume.left..ml.", "Testicular.volume.right..ml.", "Testicular.texture", "Evidence.of.TART", "Fertility.desired", "Fertility.attempted", "Sperm.storage", "Number.of.offspring", "History.of.assisted.conception", "Breast.stage", "Menarche", "Age.at.first.menstruation", "Regular.menstrual.cycle", "Number.of.pregnancies.in.the.past", "Number.of.live.births", "Notes",
"Medicine_1.x", "Dose_1", "Unit_1", "Standardised.doses_1", "dose_time_hours_1",
"Medicine_2.x", "Dose_2", "Unit_2", "Standardised.doses_2", "dose_time_hours_2",
"Medicine_3.x", "Dose_3", "Unit_3", "Standardised.doses_3", "dose_time_hours_3",
"Medicine_4.x", "Dose_4", "Unit_4", "Standardised.doses_4",
"total_standardised_daily_dose_1_1",
"Medicine_1.y", "Medicine_2.y", "Medicine_3.y", "Medicine_4.y",
"Assessment.ID.y", "Date.y", "X17.OHP.value", "X17.OHP.unit", "X17.OHP.interpretation", "Androstenedione.value", "Androstenedione.unit", "Androstenedione.interpretation", "Renin.value", "Renin.unit", "Renin.interpretation", "Renin.plasma.activity", "Total.testosterone.value", "Total.testosterone.unit", "Total.testosterone.interpretation", "Glucose.value", "Glucose.interpretation")
minimal_dataset <- all_data[, minimal_dataset_columns]
write.csv(minimal_dataset, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/minimal_data_set.csv", row.names = FALSE, na = "")
```{r}
minimal_dataset_Feb25_Nov24 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30")
minimal_dataset_Nov24_Nov23 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2024-11-30"  & Date.of.Assessment > "2023-11-30")
minimal_dataset_Nov23_Nov22 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2023-11-30"  & Date.of.Assessment > "2022-11-30")
minimal_dataset_Feb25_Nov24 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2025-02-07"  & Date.of.Assessment > "2024-11-30")
minimal_dataset_Nov24_Nov23 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2024-11-30"  & Date.of.Assessment > "2023-11-30")
minimal_dataset_Nov23_Nov22 <- minimal_dataset %>%
filter(Date.of.Assessment <= "2023-11-30"  & Date.of.Assessment > "2022-11-30")
write.csv(minimal_dataset_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/minimal_dataset_Feb25_Nov24.csv", row.names = FALSE, na = "")
write.csv(minimal_dataset_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/minimal_dataset_Nov24_Nov23.csv", row.names = FALSE, na = "")
write.csv(minimal_dataset_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/minimal_dataset_Nov23_Nov22.csv", row.names = FALSE, na = "")
View(missing_data_per_centre_Nov23_Nov22)
View(participants_per_centre_Nov23_Nov22)
View(visits_per_patient_per_centre_Nov23_Nov22)
View(minimal_dataset_Nov23_Nov22)
View(participants_per_centre_Nov23_Nov22)
View(visits_per_centre)
