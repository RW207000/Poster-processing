write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(n = n())
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
View(visits_stats_Nov23_Nov22)
View(visits_per_patient_per_centre_Nov23_Nov22)
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(n = n(n))
View(visits_per_patient_per_centre_Feb25_Nov24)
View(visits_statsFeb25_Nov24)
View(visits_per_patient_per_centre_Nov24_Nov23)
View(visits_stats_Nov24_Nov23)
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x, n) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
#
visits_per_patient_per_centre_Nov23_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov23_Nov22.csv", row.names = F)
write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
#
visits_per_patient_per_centre_before_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment >= "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_before_Nov22.csv", row.names = F)
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
View(visits_per_patient_per_centre_Nov23_Nov22)
View(visits_stats_Nov23_Nov22)
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
View(visits_stats_Feb25_Nov24)
View(visits_per_patient_per_centre_Feb25_Nov24)
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
#
visits_per_patient_per_centre_Nov23_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov23_Nov22.csv", row.names = F)
write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
#
visits_per_patient_per_centre_before_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment >= "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_before_Nov22.csv", row.names = F)
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
View(visits_per_patient_per_centre_Nov23_Nov22)
View(visits_stats_Nov23_Nov22)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
longitudinal <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Longitudinal data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants_longitudinal <- merge(participants, longitudinal, by = "CO.ID",
all = TRUE)
participants_longitudinal$Date.of.Assessment <- as.Date(participants_longitudinal$Date.of.Assessment, format = "%d/%m/%Y")
#make unique identifier
participants_longitudinal$CO.ID_assessment_date <- paste0(participants_longitudinal$CO.ID, participants_longitudinal$Date.of.Assessment)
write.csv(participants_longitudinal, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/participants_longitudinal.csv", row.names = F)
centres <-as.data.frame(unique(participants_longitudinal$Centre.ID.x))
centres <- centres %>%
rename("Centre ID" = "unique(participants_longitudinal$Centre.ID.x)")
print("There are")
length(centres$`Centre ID`)
print("centres")
patients_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID)) %>%
as.data.frame() %>%
rename("number of patients" = "n_unique(CO.ID)")
visits_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n = n()) %>%
rename("number of visits" = "n")
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
#
visits_per_patient_per_centre_Nov23_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov23_Nov22.csv", row.names = F)
write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
#
visits_per_patient_per_centre_before_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment >= "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_before_Nov22.csv", row.names = F)
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
centre_stats <- full_join(patients_per_centre, visits_per_centre, by = "Centre.ID.x")
write.csv(centre_stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/centre_stats.csv", row.names = F)
meds_wide <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/meds_wide.csv", header=T, na.strings= c("", "NA"))
# format date
meds_wide$Date.of.Assessment_1 <- as.Date(meds_wide$Date.of.Assessment_1, format = "%Y-%m-%d")
# let's add unique identifier
meds_wide$CO.ID_assessment_date <- paste0(meds_wide$CO.ID, meds_wide$Date.of.Assessment_1)
# identify and remove any duplicates
med_duplicates <- as.data.frame(freq(meds_wide$CO.ID_assessment_date))
med_duplicates <- rownames_to_column(med_duplicates, var="CO.ID_assessment_date")
med_duplicates <- med_duplicates[med_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
med_duplicates <- med_duplicates[-c(3:6)]
med_duplicates <- med_duplicates %>%
filter(Freq>1)
med_to_remove <- med_duplicates$CO.ID_assessment_date
meds_wide_no_duplicates <- subset(meds_wide, !CO.ID_assessment_date %in% med_to_remove)
# all frequencies here should be 1
med_freq_check <- as.data.frame(freq(meds_wide_no_duplicates$CO.ID_assessment_date))
# instances of 'other' in medicine names need to be rectified. I have done this manually in excel for now.
adjusted_medication_names <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/adjusted_medication_names.csv", header=T, na.strings= c("", "NA"))
adjusted_medication_names$Date <- as.Date(adjusted_medication_names$Date, format = "%d/%m/%Y")
adjusted_medication_names$CO.ID_assessment_date <- paste0(adjusted_medication_names$CO.ID, adjusted_medication_names$Date)
# now need to link to meds_wide_no_duplicates
meds_wide_adj <- left_join(meds_wide_no_duplicates, adjusted_medication_names, by = c("CO.ID_assessment_date"))
# now let's tidy up the columns
# replace other with actual medication
meds_wide_adj$Medicine_1.x <- meds_wide_adj$Medicine_1.y
meds_wide_adj$Medicine_2.x <- meds_wide_adj$Medicine_2.y
meds_wide_adj$Medicine_3.x <- meds_wide_adj$Medicine_3.y
meds_wide_adj$Medicine_4.x <- meds_wide_adj$Medicine_4.y
biomarkers <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers.csv", header=T, na.strings= c("", "NA"))
# format date
biomarkers$Date <- as.Date(biomarkers$Date, format = "%d/%m/%Y")
# add unique identifier
biomarkers$CO.ID_assessment_date <- paste0(biomarkers$CO.ID, biomarkers$Date)
# identify and remove any duplicates
biomarker_duplicates <- as.data.frame(freq(biomarkers$CO.ID_assessment_date))
biomarker_duplicates <- rownames_to_column(biomarker_duplicates, var="CO.ID_assessment_date")
biomarker_duplicates <- biomarker_duplicates[biomarker_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
biomarker_duplicates <- biomarker_duplicates[-c(3:6)]
biomarker_duplicates <- biomarker_duplicates %>%
filter(Freq>1)
biomarkers_to_remove <- biomarker_duplicates$CO.ID_assessment_date
biomarkers_no_duplicates <- subset(biomarkers, !CO.ID_assessment_date %in% biomarkers_to_remove)
# all frequencies here should be 1
biomarker_freq_check <- as.data.frame(freq(biomarkers_no_duplicates$CO.ID_assessment_date))
all_data <- left_join(participants_longitudinal, meds_wide_adj, by = c("CO.ID_assessment_date"))
all_data <- left_join(all_data, biomarkers_no_duplicates, by = c("CO.ID_assessment_date"))
write.csv(all_data, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data.csv", row.names = FALSE, na = "")
all_data_Feb25_Nov24 <- all_data %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11")
write.csv(all_data_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Feb25_Nov24.csv", row.names = FALSE, na = "")
all_data_Nov24_Nov23 <- all_data %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11")
write.csv(all_data_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov24_Nov23.csv", row.names = FALSE, na = "")
all_data_Nov23_Nov22 <- all_data %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11")
write.csv(all_data_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov23_Nov22.csv", row.names = FALSE, na = "")
all_data_before_Nov22 <- all_data %>%
filter(Date.of.Assessment >= "2022-01-11")
write.csv(all_data_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_before_Nov22.csv", row.names = FALSE, na = "")
pcntMissing <- function(col) length(col[col == ""])/length(col)
missing_data_per_centre <- all_data %>%
group_by(Centre.ID.x) %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre.csv", row.names = FALSE, na = "")
missing_data_per_centre_Feb25_Nov24 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Feb25_Nov24.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov24_Nov23 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov24_Nov23.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov23_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov23_Nov22.csv", row.names = FALSE, na = "")
missing_data_per_centre_before_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment > "2022-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_before_Nov22.csv", row.names = FALSE, na = "")
participants_per_centre_Feb25_Nov24 <- all_data_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
View(participants_per_centre_Feb25_Nov24)
participants_per_centre_Nov24_Nov23 <- all_data_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
View(participants_per_centre_Nov24_Nov23)
participants_per_centre_Nov23_Nov22 <- all_data_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
View(participants_per_centre_Nov23_Nov22)
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "readxl", "dplyr", "magrittr", "mixtools", "emmeans", "readr","data.table", "lubridate", "ggplot2", "skimr", "ggstatsplot","summarytools", "knitr", "here", "ggthemes", "Amelia", "tidyr", "naniar", "stringr", "janitor")
lapply(packages, library, character.only = TRUE)
participants <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Core only 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# participants$Date...CAH.Longitudinal.Data <- as.Date(participants$Date...CAH.Longitudinal.Data, format = "%d/%m/%Y")
medication <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Glucocorticoids Data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
medication <- remove_empty(medication, c("cols"), cutoff = 1)
# medication$assessment_date <- as.Date(medication$assessment_date, format = "%d/%m/%Y")
labs <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Labs data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
# labs$assessment_date <- as.Date(labs$assessment_date, format = "%d/%m/%Y")
longitudinal <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/Longitudinal data 24.02.2025.csv", header=T, na.strings= c("", "NA"))
participants_longitudinal <- merge(participants, longitudinal, by = "CO.ID",
all = TRUE)
participants_longitudinal$Date.of.Assessment <- as.Date(participants_longitudinal$Date.of.Assessment, format = "%d/%m/%Y")
#make unique identifier
participants_longitudinal$CO.ID_assessment_date <- paste0(participants_longitudinal$CO.ID, participants_longitudinal$Date.of.Assessment)
write.csv(participants_longitudinal, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/participants_longitudinal.csv", row.names = F)
centres <-as.data.frame(unique(participants_longitudinal$Centre.ID.x))
centres <- centres %>%
rename("Centre ID" = "unique(participants_longitudinal$Centre.ID.x)")
print("There are")
length(centres$`Centre ID`)
print("centres")
patients_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID)) %>%
as.data.frame() %>%
rename("number of patients" = "n_unique(CO.ID)")
visits_per_centre <- participants_longitudinal %>%
group_by(Centre.ID.x) %>%
summarise(n = n()) %>%
rename("number of visits" = "n")
visits_per_patient_per_centre <- participants_longitudinal %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n=n())
write.csv(visits_per_patient_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre.csv", row.names = F)
#
visits_per_patient_per_centre_Feb25_Nov24 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Feb25_Nov24 <- visits_per_patient_per_centre_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Feb25_Nov24.csv", row.names = F)
write.csv(visits_stats_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Feb25_Nov24.csv", row.names = F)
#
visits_per_patient_per_centre_Nov24_Nov23 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov24_Nov23 <- visits_per_patient_per_centre_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov24_Nov23.csv", row.names = F)
write.csv(visits_stats_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov24_Nov23.csv", row.names = F)
#
visits_per_patient_per_centre_Nov23_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_Nov23_Nov22 <- visits_per_patient_per_centre_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_Nov23_Nov22.csv", row.names = F)
write.csv(visits_stats_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_Nov23_Nov22.csv", row.names = F)
#
visits_per_patient_per_centre_before_Nov22 <- participants_longitudinal %>%
filter(Date.of.Assessment >= "2022-01-11") %>%
group_by(CO.ID, Centre.ID.x) %>%
summarise(n = n())
visits_stats_before_Nov22 <- visits_per_patient_per_centre_before_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(sum(n))
write.csv(visits_per_patient_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_per_patient_per_centre_before_Nov22.csv", row.names = F)
write.csv(visits_stats_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/visits_stats_before_Nov22.csv", row.names = F)
centre_stats <- full_join(patients_per_centre, visits_per_centre, by = "Centre.ID.x")
write.csv(centre_stats, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/centre_stats.csv", row.names = F)
meds_wide <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/meds_wide.csv", header=T, na.strings= c("", "NA"))
# format date
meds_wide$Date.of.Assessment_1 <- as.Date(meds_wide$Date.of.Assessment_1, format = "%Y-%m-%d")
# let's add unique identifier
meds_wide$CO.ID_assessment_date <- paste0(meds_wide$CO.ID, meds_wide$Date.of.Assessment_1)
# identify and remove any duplicates
med_duplicates <- as.data.frame(freq(meds_wide$CO.ID_assessment_date))
med_duplicates <- rownames_to_column(med_duplicates, var="CO.ID_assessment_date")
med_duplicates <- med_duplicates[med_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
med_duplicates <- med_duplicates[-c(3:6)]
med_duplicates <- med_duplicates %>%
filter(Freq>1)
med_to_remove <- med_duplicates$CO.ID_assessment_date
meds_wide_no_duplicates <- subset(meds_wide, !CO.ID_assessment_date %in% med_to_remove)
# all frequencies here should be 1
med_freq_check <- as.data.frame(freq(meds_wide_no_duplicates$CO.ID_assessment_date))
# instances of 'other' in medicine names need to be rectified. I have done this manually in excel for now.
adjusted_medication_names <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/data/adjusted_medication_names.csv", header=T, na.strings= c("", "NA"))
adjusted_medication_names$Date <- as.Date(adjusted_medication_names$Date, format = "%d/%m/%Y")
adjusted_medication_names$CO.ID_assessment_date <- paste0(adjusted_medication_names$CO.ID, adjusted_medication_names$Date)
# now need to link to meds_wide_no_duplicates
meds_wide_adj <- left_join(meds_wide_no_duplicates, adjusted_medication_names, by = c("CO.ID_assessment_date"))
# now let's tidy up the columns
# replace other with actual medication
meds_wide_adj$Medicine_1.x <- meds_wide_adj$Medicine_1.y
meds_wide_adj$Medicine_2.x <- meds_wide_adj$Medicine_2.y
meds_wide_adj$Medicine_3.x <- meds_wide_adj$Medicine_3.y
meds_wide_adj$Medicine_4.x <- meds_wide_adj$Medicine_4.y
biomarkers <- read.csv("C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/CAH_biomarkers.csv", header=T, na.strings= c("", "NA"))
# format date
biomarkers$Date <- as.Date(biomarkers$Date, format = "%d/%m/%Y")
# add unique identifier
biomarkers$CO.ID_assessment_date <- paste0(biomarkers$CO.ID, biomarkers$Date)
# identify and remove any duplicates
biomarker_duplicates <- as.data.frame(freq(biomarkers$CO.ID_assessment_date))
biomarker_duplicates <- rownames_to_column(biomarker_duplicates, var="CO.ID_assessment_date")
biomarker_duplicates <- biomarker_duplicates[biomarker_duplicates$CO.ID_assessment_date != c("Total", "<NA>"),]
biomarker_duplicates <- biomarker_duplicates[-c(3:6)]
biomarker_duplicates <- biomarker_duplicates %>%
filter(Freq>1)
biomarkers_to_remove <- biomarker_duplicates$CO.ID_assessment_date
biomarkers_no_duplicates <- subset(biomarkers, !CO.ID_assessment_date %in% biomarkers_to_remove)
# all frequencies here should be 1
biomarker_freq_check <- as.data.frame(freq(biomarkers_no_duplicates$CO.ID_assessment_date))
all_data <- left_join(participants_longitudinal, meds_wide_adj, by = c("CO.ID_assessment_date"))
all_data <- left_join(all_data, biomarkers_no_duplicates, by = c("CO.ID_assessment_date"))
write.csv(all_data, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data.csv", row.names = FALSE, na = "")
all_data_Feb25_Nov24 <- all_data %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11")
write.csv(all_data_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Feb25_Nov24.csv", row.names = FALSE, na = "")
all_data_Nov24_Nov23 <- all_data %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11")
write.csv(all_data_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov24_Nov23.csv", row.names = FALSE, na = "")
all_data_Nov23_Nov22 <- all_data %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11")
write.csv(all_data_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_Nov23_Nov22.csv", row.names = FALSE, na = "")
all_data_before_Nov22 <- all_data %>%
filter(Date.of.Assessment >= "2022-01-11")
write.csv(all_data_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/all_data_before_Nov22.csv", row.names = FALSE, na = "")
pcntMissing <- function(col) length(col[col == ""])/length(col)
missing_data_per_centre <- all_data %>%
group_by(Centre.ID.x) %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre.csv", row.names = FALSE, na = "")
missing_data_per_centre_Feb25_Nov24 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2025-07-02"  & Date.of.Assessment > "2024-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Feb25_Nov24, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Feb25_Nov24.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov24_Nov23 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2024-01-11"  & Date.of.Assessment > "2023-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov24_Nov23, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov24_Nov23.csv", row.names = FALSE, na = "")
missing_data_per_centre_Nov23_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment <= "2023-01-11"  & Date.of.Assessment > "2022-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_Nov23_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_Nov23_Nov22.csv", row.names = FALSE, na = "")
missing_data_per_centre_before_Nov22 <- all_data %>%
group_by(Centre.ID.x) %>%
filter(Date.of.Assessment > "2022-01-11") %>%
summarise(across(everything(), pcntMissing)) %>%
round(., digits = 2)
write.csv(missing_data_per_centre_before_Nov22, file = "C:/Users/md1rwe/Documents/Data extractions from I-CAH/Feb 2025/I-CAH_data_Feb_2025/outputs/all_data/missing_data_per_centre_before_Nov22.csv", row.names = FALSE, na = "")
participants_per_centre_Feb25_Nov24 <- all_data_Feb25_Nov24 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
participants_per_centre_Nov24_Nov23 <- all_data_Nov24_Nov23 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
participants_per_centre_Nov23_Nov22 <- all_data_Nov23_Nov22 %>%
group_by(Centre.ID.x) %>%
summarise(n_unique(CO.ID.x))
print("Script complete")
